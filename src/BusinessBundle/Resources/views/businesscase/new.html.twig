{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ form_stylesheet(form) }}
{% endblock %}

{% block breadcrumb %}
    <li class="">{{ "business_management"|trans|capitalize }}</li>
    <li class=""><a href="{{ path('business_case_index') }}">{{ "business_cases"|trans|capitalize }}</a></li>
    <li class="active">{{ "addition"|trans|capitalize }}</li>
{% endblock %}

{% block page_title %}{{ "creation_of_business_case"|trans|capitalize }}{% endblock %}

{% block title %}
    {{ "creation_of_business_case"|trans|capitalize }}
{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="x_panel">
                <div class="x_title">
                    <h2><i class="fa fa-folder-open"></i> {{ "create"|trans|capitalize }} {{ "a_business_case"|trans }}</h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    {{ form_start(form, {'attr': {'class': 'form-horizontal form-label-left business-case-form dropzone', 'novalidate': '', 'enctype': "multipart/form-data"}}) }}

                    <!-- Smart Wizard -->
                    {#<p>This is a basic form wizard example that inherits the colors from the selected scheme.</p>#}
                    <div id="wizard" class="form_wizard wizard_horizontal">
                        <ul class="wizard_steps anchor" style="border-bottom: 1px solid lightgrey">
                            <li>
                                <a href="#step-1">
                                    <span class="step_no">1</span>
                                    <span class="step_descr">
                                              {#{{ "step_capitalize"|trans }} 1<br />#}
                                              <small>{{ "general_data_capitalize"|trans }}</small>
                                          </span>
                                </a>
                            </li>
                            <li>
                                <a href="#step-2">
                                    <span class="step_no">2</span>
                                    <span class="step_descr">
                                              {#{{ "step_capitalize"|trans }} 2<br />#}
                                              <small> {{ "customer_data_capitalize"|trans }}</small>
                                          </span>
                                </a>
                            </li>
                            <li>
                                <a href="#step-3">
                                    <span class="step_no">3</span>
                                    <span class="step_descr">
                                              {#{{ "step_capitalize"|trans }} 3<br />#}
                                              <small>{{ "internal_data_capitalize"|trans }}</small>
                                          </span>
                                </a>
                            </li>
                            <li>
                                <a href="#step-4">
                                    <span class="step_no">4</span>
                                    <span class="step_descr">
                                              {#{{ "step_capitalize"|trans }} 4<br />#}
                                              <small>{{ "media_capitalize"|trans }}</small>
                                          </span>
                                </a>
                            </li>
                        </ul>
                        <div id="step-1" >
                            <div class="form-group">
                                {% if form.name.vars.required %} <span class="required">*</span> {% endif %}
                                {{ form_label(form.name, null, {'label_attr': {'class': 'control-label col-md-3 col-sm-3 col-xs-12'}}) }}
                                <div class="col-md-6 col-sm-6 col-xs-12">
                                    {{ form_widget(form.name, {'attr': {'class': 'form-control col-md-7 col-xs-12'}}) }}
                                    {{ form_errors(form.name) }}
                                </div>
                            </div>
                            <div class="form-group">
                                {% if form.externalReference.vars.required %} <span class="required">*</span> {% endif %}
                                {{ form_label(form.externalReference, null, {'label_attr': {'class': 'control-label col-md-3 col-sm-3 col-xs-12'}}) }}
                                <div class="col-md-6 col-sm-6 col-xs-12">
                                    {{ form_widget(form.externalReference, {'attr': {'class': 'form-control col-md-7 col-xs-12'}}) }}
                                    {{ form_errors(form.externalReference) }}
                                </div>
                            </div>
                            <div class="form-group">
                                {% if form.internalReference.vars.required %} <span class="required">*</span> {% endif %}
                                {{ form_label(form.internalReference, null, {'label_attr': {'class': 'control-label col-md-3 col-sm-3 col-xs-12'}}) }}
                                <div class="col-md-6 col-sm-6 col-xs-12">
                                    {{ form_widget(form.internalReference, {'attr': {'class': 'form-control col-md-7 col-xs-12'}}) }}
                                    {{ form_errors(form.internalReference) }}
                                </div>
                            </div>
                            <div class="form-group">
                                {% if form.user.vars.required %} <span class="required">*</span> {% endif %}
                                {{ form_label(form.user, null, {'label_attr': {'class': 'control-label col-md-3 col-sm-3 col-xs-12'}}) }}
                                <div class="col-md-6 col-sm-6 col-xs-12">
                                    {{ form_widget(form.user, {'attr': {'class': 'form-control col-md-12 col-xs-12'}}) }}
                                    {{ form_errors(form.user) }}
                                </div>
                            </div>
                        </div>
                        <div id="step-2">
                            <div class="form-group">
                                {% if form.customerType.vars.required %} <span class="required">*</span> {%  endif %}
                                {{ form_label(form.customerType, null, {'label_attr': {'class': 'control-label col-md-3 col-sm-3 col-xs-12'}}) }}
                                <div class="col-md-6 col-sm-6 col-xs-12">
                                    {{ form_widget(form.customerType) }}
                                    {{ form_errors(form.customerType) }}
                                </div>
                            </div>
                            <div class="form-group">
                                {% if form.customer.vars.required %} <span class="required">*</span> {%  endif %}
                                {{ form_label(form.customer, null, {'label_attr': {'class': 'control-label col-md-3 col-sm-3 col-xs-12'}}) }}
                                <div class="col-md-6 col-sm-6 col-xs-12 render-customer-list">
                                    {{ form_widget(form.customer, {'attr': {'class': 'form- control col-md-12 col-xs- 12'}}) }}
                                    {{ form_errors(form.customer) }}
                                </div>
                            </div>
                            <div class="form-group">
                                {% if form.customerContact.vars.required %} <span class="required">*</span> {%  endif %}
                                {{ form_label(form.customerContact, null, {'label_attr': {'class': 'control-label col-md-3 col-sm-3 col-xs-12'}}) }}
                                <div class="col-md-6 col-sm-6 col-xs-12 render-customerContact-list">
                                    {{ form_widget(form.customerContact, {'attr': {'class': 'form-control col-md-12 col-xs-12'}}) }}
                                    {{ form_errors(form.customerContact) }}
                                </div>
                            </div>
                        </div>
                        <div id="step-3">
                            <p>
                                sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore
                                eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                            </p>
                            <p>
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor
                                in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                            </p>
                        </div>
                        <div id="step-4">
                            <div class="form-group">
                                {{ form_label(form.businessCaseGalleries, null, {'label_attr': {'class': 'control-label col-md-2 col-sm-2 col-xs-12'}}) }}
                                {#<div class="col-md-10 col-sm-10 col-xs-12">#}
                                {{ form_widget(form.businessCaseGalleries) }}
                                {{ form_errors(form.businessCaseGalleries) }}
                                {#</div>#}
                            </div>
                        </div>
                        {#<a href="{{ path('business_case_index') }}" class="btn btn-primary"><i class="fa fa-long-arrow-left" aria-hidden="true"></i> {{ "cancel"|trans|capitalize }}</a>#}
                        {#<button type="submit" class="btn btn-success"><i class="fa fa-check" aria-hidden="true"></i> {{ "create"|trans|capitalize }}</button>#}
                        {#</div>#}
                        {#</div>#}
                    </div>
                    <!-- End SmartWizard Content -->
                    <br>
                    <button type="submit" class="btn btn-success"><i class="fa fa-check" aria-hidden="true" style="display: none"></i> {{ "create"|trans|capitalize }}</button>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block custom_javascripts %}
    {{ parent() }}
{% endblock %}
{% block plain_js_bundle %}
    {{ form_javascript(form) }}
    <script>
        //Ready
        $(function() {
            ajaxSubmitReloadNextByRadioBox("business-case-form", "input:radio", "businessbundle_businesscase", "customerType", "customer", []);
            ajaxSubmitReloadNextByRadioBox("business-case-form", "select", "businessbundle_businesscase", "customer", "customerContact", [{name: "customerType", type: ":radio"}]);

            $(".business-case-form").on("mouseup", "#businessbundle_businesscase_customerType", function(event){
                var $val = $("input:radio[name^='businessbundle_businesscase[customerType]']:checked");
                if(typeof $val.val() !== "undefined"){
                    cleanChildren("businessbundle_businesscase_", true, ["customer_contact"]);
                }
            });

            function loadFileInput(inputField){
                inputField.fileinput({
                    initialPreviewAsData: true,
                    showCaption: true,
                    showRemove: true,
                    showUpload:true
                });
            };

            function loadMediasCollection(mediaCollectionField){
                /**
                 * Launch BusinessCaseGallery collection
                 */
                mediaCollectionField.collection({
                    allow_duplicate: false,
                    after_add: function () {
                        loadFileInput($(".media-file-input"));
                        $("select").select2({ width: '100%' });
                        return true;
                    },
                    allow_up: false,
                    allow_down: false,
                    allow_add: true,
                    allow_remove: true,
                    min: 1,
                    // max: 200,
                    add: '<a href="#" class="collection-add btn btn-xs btn-success" title="{{ 'add_media'|trans }}"><span class="glyphicon glyphicon-plus-sign"></span></a>',
                    remove: '<a href="#" class="collection-remove btn btn-xs btn-danger" title="Supprimer ce media"><span class="glyphicon glyphicon-trash"></span></a>'
                });
            }

            /**
             * Launch BusinessCaseGallery collection
             */
            $(".item-collection").each(function() {
                $(this).collection({
                    allow_duplicate: false,
                    after_add: function (collection, element) {
                        $("select").select2({ width: '100%' });
                        //console.log(collection);
                        //console.log(element);
                        mediasCollection = element.find('.item-collection-multiple-media');
                        loadMediasCollection(mediasCollection);
                        return true;
                    },
                    allow_up: false,
                    allow_down: false,
                    allow_add: true,
                    allow_remove: true,
                    min: 1,
                    // max: 200,
                    add: '<a href="#" class="collection-add btn btn-default btn-success" title="Ajouter un élément"><span class="glyphicon glyphicon-plus-sign"></span></a>',
                    remove: '<a href="#" class="collection-remove btn btn-default btn-danger" title="Supprimer cet élément"><span class="glyphicon glyphicon-trash"></span></a>'
                });
            });

            /**
             * Launch GalleryMedias collection
             */
            loadMediasCollection($(".item-collection-multiple-media"));

            $(".media-file-input").fileinput({});

            // Textarea WYSIWYG
            $(".tinymce-textarea").tinymce();
        });
    </script>
{% endblock %}